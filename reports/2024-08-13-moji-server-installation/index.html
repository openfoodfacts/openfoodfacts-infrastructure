
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../2024-08-07-wordpress-off-contents-fresh-install/">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>Moji server installation - Open Food Facts Infrastructure documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#moji-server-installation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Open Food Facts Infrastructure documentation" class="md-header__button md-logo" aria-label="Open Food Facts Infrastructure documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Open Food Facts Infrastructure documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Moji server installation
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/openfoodfacts/openfoodfacts-infrastructure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Open Food Facts Infrastructure documentation" class="md-nav__button md-logo" aria-label="Open Food Facts Infrastructure documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Open Food Facts Infrastructure documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/openfoodfacts/openfoodfacts-infrastructure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open Food Facts Infrastructure
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cicd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Continous Integration and Continuous Delivery
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../discourse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Discourse
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../disks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disks
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker at Open Food Facts
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker_architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker_onboarding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Onboarding
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explain-server-config-in-git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation on server configuration with git
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../folksonomy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folksonomy API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../free-datacenter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Free Datacenter
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-add-disk-space-on-qemu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to add disk space on a Qemu VM
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-fail2ban-ban-bots/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use fail2ban to ban bots
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-fail2ban-debian-11%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to install fail2ban on debian 11+
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-have-server-config-in-git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to have server config in git
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-mitigate-crawlers-on-prod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to mitigate crawlers in case of too much traffic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux-server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux server
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-off1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    off1 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-off2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    off2 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-off3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    off3 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-ovh1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ovh1 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-ovh2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ovh2 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-ovh3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ovh3 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mail/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mail on Open Food Facts infrastructure
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../matomo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matomo
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moji-datacenter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moji Datacenter
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mongodb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../munin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Munin
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nginx-reverse-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NGINX Reverse proxy
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Observability
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odoo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Odoo: our relationship management (connect.openfoodfacts.org)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openfoodfacts-query/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open Food Facts Query
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../postgres/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PostgreSQL
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prod-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Production architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../producers_sftp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Producers SFTP
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../product-opener/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Product Opener
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proxmox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proxmox
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rclone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rclone
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redis
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sanoid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sanoid
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../slackin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auto Slack invitation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stunnel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stunnel
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../zammad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zammad
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../zfs-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZFS overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_45" checked>
        
          
          <label class="md-nav__link" for="__nav_45" id="__nav_45_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reports
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_45_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_45">
            <span class="md-nav__icon md-icon"></span>
            Reports
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2021-02-22-matomo-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matomo install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2021-10-03-network-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    [Postmortem] OpenFoodFacts.net down (#1)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2021-12-21-disk-extension/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disk extension for preprod and containers prod (ovh2)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2021-12-22-preprod-crash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprod crash 2021 12
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-02-18-ovh-reverse-proxy-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    [Postmortem] Reverse proxy down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-02-proxmox-mail-gateway-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install of proxmox gateway server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-02-remove-containers-ovh1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-02 Removing some containers on ovh1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-03-03-zammad-elasticsearch-not-running/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elasticsearch not running on Zammad
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-03-off2-PCI-NVMe-problems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-03 Problem with PCI supporting NVMe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-07-08-journey-to-deploy-off-search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying openfoodfacts-search to staging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-07-11-infra-workshop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure future - workshop on 11th July 2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-07-kibana-down-es-circuit-breaking-exception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kibana down because of Elasticsearch circuit_breaking_exception
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-08-17-openfoodfacts-net-unreachable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-08-17 openfoodfacts.net unreachable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-09-23-odoo-setup-for-pro-platform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup of Odoo for pro platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-11-09-monitoring-move-to-own-vm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-11 moving monitoring to its own machine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-02-13-zammad-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-02-13 Zammad down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-02-16-off2-shutdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023 02 16 off2 shutdown
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-02-17-off2-upgrade/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-02-17 Off2 Upgrade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-02-24-zfs-introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023 02 24 zfs introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-03-14-off2-opff-reinstall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-03 OFF2 reinstall - opff migration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-04-27-moving-docker-stagging-to-ovh1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-04-27 moving docker staging to OVH1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-05-12-refresh-staging-clones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-05-12 refresh staging clones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-05-19-overload-of-osm-machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-05-18 Mongodb down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-05-23-move-images-to-zfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-05-23 move Images to ZFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-05-off2-110-unreachable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-05-23 off2 - container 110 unreachable from 101
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-06-01-robotoff-backups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-06-01 Robotoff backups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-06-07-off2-opf-obf-reinstall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-06-07 OPF and OBF reinstall on off2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-06-08-stalled-zfs-sync-off-products/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2012-06-08 Stalled ZFS Sync for off products on ovh3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-06-30-sanoid-checks-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-06-30 Sanoid checks install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-07-16-ovh3-sdc-broken/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Post-mortem 2023-07-16 Disk sdc errors on OVH3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-07-26-off1-rpool-products-full/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-07-26 rpool/off/products dataset full on off1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-07-off-reinstall--prod-files-diff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023 07 off reinstall  prod files diff
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-07-off2-off-reinstall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-06-07 OFF and OFF-pro reinstall on off2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-08-31-off2-products-snapshots-clean/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-08-31 OFF2 products snapshots clean
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-09-27-expired-ssl-certificate-for-images-on-off2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-09-27 / Expired SSL certificate for images.openfoodfacts.org on off2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-10-14-mongodb-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-10-14: mongodb-down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-11-28-google-drive-backup-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-11-28 setup a google drive backup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-11-28-ovh3-sdf-broken/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Post-mortem 2023-11-28 Disk sdf errors on OVH3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-12-08-off1-upgrade/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-12-08 off1 upgrade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-12-11-matomo-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-12-11 Matomo down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-02-monitoring-disk-space/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-01-02 monitoring disk space - filebeat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-03-mongodb-migration-off1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-01-03 MongoDB migration on off3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-04-setting-up-stunnel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024 01 04 setting up stunnel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-19-certbot-failure-off2-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-01-19 Certbot failure on off2 reverse proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-24-move-old-productopener-folders-to-backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-01-24 Move old Product Opener folders to backup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-matomo-perf-tunning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-01 Matomo performance tunning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-06-cleanup-products-snapshots/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-02-06 cleanup of products ssnapshots on off2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-08-prod-redis-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-02-08 Production Redis install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-13-chatwoot-translation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-02-13 Chatwoot translation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-13-matomo-fix-queue0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2014-02-13 Matomo fix Queue0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-20-exporter-on-mongodb-ct/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-02-20 Installing a prometheus exporter on mongodb container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-28-upgrade-redis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-02-28 Upgrade Redis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-03-17-ovh1-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-03-17 OVH1 Down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-03-restructure-backups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-03 Restructure backups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-03-separate-hdd-docker-vms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-03 separate HDD on docker VMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-04-03-moving-opf-obf-opff-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-03-04 Moving opf, obf and opff logs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-04-12-install-off-query-off1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-04 install off-query on off1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-04-18-matomo-multi-archival/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-04-18 Matomo multi archival
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-04-18-setup-dkim-google-workspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-04-18 Setup DKIM on Google Workspace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-05-27-nginx-exporter-off2-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nginx exporter on off2 proxy and off
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-06-05-off1-reverse-proxy-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-06 OFF1 reverse proxy install + OFF images container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-06-10-move-off-query-volume-to-nvme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Move off query volume to NVME
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-08-03-ovh-reverse-proxy-ip-lost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-08-03 OVH Reverse proxy IP lost
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-08-07-wordpress-off-contents-fresh-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-08-07-wordpress-off-contents-fresh-install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Moji server installation
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Moji server installation
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#proxmox-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Proxmox configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-docker-prod-2-vm" class="md-nav__link">
    <span class="md-ellipsis">
      Create the docker-prod-2 VM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the docker-prod-2 VM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#info" class="md-nav__link">
    <span class="md-ellipsis">
      Info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Post-installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipv6-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      ipv6 configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ipv6 configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#solution-1" class="md-nav__link">
    <span class="md-ellipsis">
      Solution 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution-4" class="md-nav__link">
    <span class="md-ellipsis">
      Solution 4
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stunnel-client-ct-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      stunnel-client CT configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stunnel-client CT configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Create the container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-stunnel" class="md-nav__link">
    <span class="md-ellipsis">
      Install stunnel
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stunnel-server-ct-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      stunnel-server CT configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stunnel-server CT configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-container_1" class="md-nav__link">
    <span class="md-ellipsis">
      Create the container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-stunnel_1" class="md-nav__link">
    <span class="md-ellipsis">
      Install stunnel
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-robotoff-services" class="md-nav__link">
    <span class="md-ellipsis">
      Install Robotoff services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ovh1-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      OVH1 configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OVH1 configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#added-ipv6-to-ovh1-proxy-ct-101" class="md-nav__link">
    <span class="md-ellipsis">
      Added ipv6 to OVH1 Proxy CT (101)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-proxy-stunnel-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Update proxy stunnel configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#robotoff-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Robotoff migration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tasks-remaining" class="md-nav__link">
    <span class="md-ellipsis">
      Tasks remaining
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#proxmox-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Proxmox configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-docker-prod-2-vm" class="md-nav__link">
    <span class="md-ellipsis">
      Create the docker-prod-2 VM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create the docker-prod-2 VM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Pre-installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#info" class="md-nav__link">
    <span class="md-ellipsis">
      Info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Post-installation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipv6-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      ipv6 configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ipv6 configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#solution-1" class="md-nav__link">
    <span class="md-ellipsis">
      Solution 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#solution-4" class="md-nav__link">
    <span class="md-ellipsis">
      Solution 4
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stunnel-client-ct-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      stunnel-client CT configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stunnel-client CT configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      Create the container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-stunnel" class="md-nav__link">
    <span class="md-ellipsis">
      Install stunnel
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stunnel-server-ct-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      stunnel-server CT configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stunnel-server CT configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-container_1" class="md-nav__link">
    <span class="md-ellipsis">
      Create the container
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-stunnel_1" class="md-nav__link">
    <span class="md-ellipsis">
      Install stunnel
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-robotoff-services" class="md-nav__link">
    <span class="md-ellipsis">
      Install Robotoff services
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ovh1-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      OVH1 configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OVH1 configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#added-ipv6-to-ovh1-proxy-ct-101" class="md-nav__link">
    <span class="md-ellipsis">
      Added ipv6 to OVH1 Proxy CT (101)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-proxy-stunnel-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Update proxy stunnel configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#robotoff-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Robotoff migration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tasks-remaining" class="md-nav__link">
    <span class="md-ellipsis">
      Tasks remaining
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="moji-server-installation">Moji server installation<a class="headerlink" href="#moji-server-installation" title="Permanent link">#</a></h1>
<p>We have a new server hosted by Moji, thanks to Open Street Maps.
The server is a Dell T630 with 2 1080Ti GPUs, 128GB of RAM, 56 cores, 1x 8TB NVMe, 8x 8TB HDD.</p>
<p>For more information, see https://wiki.openstreetmap.org/wiki/FR:Serveurs_OpenStreetMap_France/Moji.</p>
<p>Proxmox 8.2 was already installed by Christian on the server, so we just had to configure it.</p>
<h2 id="proxmox-configuration">Proxmox configuration<a class="headerlink" href="#proxmox-configuration" title="Permanent link">#</a></h2>
<p>Create a user:</p>
<p><code>sudo pveum user add raphael@pve</code> </p>
<p>Create the admin group:</p>
<p><code>sudo pveum group add admin -comment "System Administrators"</code></p>
<p>Add user to admin group:</p>
<p><code>sudo pveum user modify  raphael@pve -groups admin</code></p>
<p>Add Administrator role to admin group:</p>
<p><code>sudo pveum acl modify / -group admin -role Administrator</code></p>
<p>Change password:</p>
<p><code>sudo pveum passwd raphael@pve</code></p>
<h2 id="create-the-docker-prod-2-vm">Create the docker-prod-2 VM<a class="headerlink" href="#create-the-docker-prod-2-vm" title="Permanent link">#</a></h2>
<p>We choose a QEMU VM instead of CT as were running docker inside.</p>
<h3 id="pre-installation">Pre-installation<a class="headerlink" href="#pre-installation" title="Permanent link">#</a></h3>
<p>Download latest Debian install ISO:  <code>debian-12.6.0-amd64-netinst.iso</code> </p>
<p>Move .iso file to <code>/var/lib/vz/template/iso</code> .</p>
<p>Create a dataset for Proxmox data:</p>
<p><code>zfs create hdd-zfs/pve</code></p>
<p>Adding a new ZFS pool as a storage for Proxmox:</p>
<p><code>pvesm add zfspool hdd-zfs -pool hdd-zfs/pve -mountpoint /hdd-zfs/pve -sparse 0</code></p>
<p>Same thing for NVMe disk:</p>
<p><code>zfs create nvme-zfs/pve</code></p>
<p><code>pvesm add zfspool nvme-zfs -pool nvme-zfs/pve -mountpoint /nvme-zfs/pve -sparse 0 -content rootdir,images</code></p>
<h3 id="info">Info<a class="headerlink" href="#info" title="Permanent link">#</a></h3>
<p>ID: 200
name: docker-prod-2 (as docker-prod is deployed in OVH cluster)</p>
<h3 id="hardware">Hardware<a class="headerlink" href="#hardware" title="Permanent link">#</a></h3>
<p>3 hard-drives were configured:</p>
<ul>
<li><code>scsi0</code>: 140 GB from nvme-zfs for machine</li>
<li><code>scsi1</code>: 300 GB for docker volumes</li>
<li><code>scsi2</code>: 400 GB</li>
</ul>
<p>RAM: 100GB (/124 GB)
Cores: 40 (/55), flag: +aes</p>
<h3 id="post-installation">Post-installation<a class="headerlink" href="#post-installation" title="Permanent link">#</a></h3>
<ul>
<li>English</li>
<li>timezone: France (in others)</li>
<li>locale: en_US.UTF8</li>
<li>keymap: french</li>
</ul>
<p>Network was manually configured:</p>
<ul>
<li>ip address: 10.3.0.200/8</li>
<li>gateway: 10.0.0.45</li>
</ul>
<p>Next:</p>
<ul>
<li>Created <code>off</code> user (and group).</li>
<li>cloned https://github.com/openfoodfacts/openfoodfacts-infrastructure into <code>/opt/openfoodfacts-infrastructure</code></li>
<li>installed docker using <code>install_docker.sh</code> script</li>
<li>added off and raphael to docker group</li>
</ul>
<p>I mounted <code>/deb/sdb1</code> (<code>UUID=60fc037f-dc90-4b4e-a7df-ceabf7955a06</code>) on <code>/var/lib/docker/volumes</code> , by updating <code>/etc/fstab</code>.</p>
<h2 id="ipv6-configuration">ipv6 configuration<a class="headerlink" href="#ipv6-configuration" title="Permanent link">#</a></h2>
<p>I added an ipv6 interface to VM 200 (<code>docker-prod-2</code>) by adding to <code>/etc/network/interfaces</code>:</p>
<div class="highlight"><pre><span></span><code>iface ens18 inet6 static
    address 2a06:c484:5::200
    netmask 48
    gateway 2a06:c484:5::
    dns-nameservers 2001:4860:4860::8888 2001:4860:4860::8844 
</code></pre></div>
<p><code>2a06:c484:5::200</code> is the ipv6 address configured (Moji gives us range <code>2a06:c484:5::/48</code>).</p>
<p>After restarting networking on VM (<code>systemctl restart networking</code>), VM is reachable using ipv6 from outside:</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt;<span class="w"> </span>ping6<span class="w"> </span>2a06:c484:5::200
PING<span class="w"> </span>2a06:c484:5::200<span class="o">(</span>2a06:c484:5::200<span class="o">)</span><span class="w"> </span><span class="m">56</span><span class="w"> </span>data<span class="w"> </span>bytes
<span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>2a06:c484:5::200:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">57</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">11</span>.9<span class="w"> </span>ms
<span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>2a06:c484:5::200:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">57</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">11</span>.1<span class="w"> </span>ms
</code></pre></div>
<p>From there, we have 3 solutions:</p>
<ol>
<li>make docker services directly joinable through ipv6</li>
<li>add a NAT rule using iptable to reroute ipv6 trafic to ipv4</li>
<li>set-up a nginx reverse-proxy in front of Robotoff, that will listen to the ipv6 server and redirects trafic on ipv4-only api container</li>
<li>Use stunnel to make Robotoff API accessible from outside</li>
</ol>
<h3 id="solution-1">Solution 1<a class="headerlink" href="#solution-1" title="Permanent link">#</a></h3>
<p>I spent some time trying solution (1), <a href="https://docs.docker.com/config/daemon/ipv6/">by enabling ipv6 on docker</a>, with this <code>/etc/docker/daemon.json</code> :</p>
<div class="highlight"><pre><span></span><code><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;metrics-addr&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;127.0.0.1:9323&quot;</span>,
<span class="w">  </span><span class="s2">&quot;experimental&quot;</span><span class="w"> </span>:<span class="w"> </span>true,
<span class="w">  </span><span class="s2">&quot;storage-driver&quot;</span>:<span class="w"> </span><span class="s2">&quot;overlay2&quot;</span>,
<span class="w">  </span><span class="s2">&quot;ipv6&quot;</span>:<span class="w"> </span>true,
<span class="w">  </span><span class="s2">&quot;userland-proxy&quot;</span>:<span class="w"> </span>false,
<span class="w">  </span><span class="s2">&quot;fixed-cidr-v6&quot;</span>:<span class="w"> </span><span class="s2">&quot;2a06:c484:5::200/48&quot;</span>
<span class="o">}</span>
</code></pre></div>
<p>Docker then assigns a random ipv6 address from the range, I didnt manage to make a docker service running locally accessible from outside. Not that its not possible, but that Im really new at ipv6 networking.</p>
<h3 id="solution-4">Solution 4<a class="headerlink" href="#solution-4" title="Permanent link">#</a></h3>
<p>As we may get an ipv4 later (Stephane is asking for one), i decided to try directly solution 4, as its easy to set-up, and has the advantage of encrypting connection between ovh1 (where the reverse proxy is in CT 101) and docker-prod-2 (VM 200 on Moji).</p>
<p>With solution (3) (nginx), the trafic is not encrypted, so stunnel is a better choice here.</p>
<p>After talking with Alex, we decided to use stunnel between the reverse proxy on OVH and robotoff on Moji.</p>
<ul>
<li>Request to Robotoff API: client  http/ipv4  reverse proxy - ipv4 -&gt; stunnel client on ovh - ipv6 -&gt; stunnel server on moji - ipv4 -&gt; robotoff on Moji (private)</li>
<li>Add a container for stunnel client<ul>
<li>should work in IPv4: it will be accessible only from other VM on Moji server, using local ipv4</li>
</ul>
</li>
<li>Add a container for stunnel server<ul>
<li>must have a public IPv6 address. Reverse proxy on OVH1 (VM 101) will reach the stunnel server using the ipv6 address.</li>
</ul>
</li>
<li>robotoff nginx proxy config should forward to stunnel client on the right pid</li>
</ul>
<h2 id="stunnel-client-ct-configuration">stunnel-client CT configuration<a class="headerlink" href="#stunnel-client-ct-configuration" title="Permanent link">#</a></h2>
<h3 id="create-the-container">Create the container<a class="headerlink" href="#create-the-container" title="Permanent link">#</a></h3>
<p>This container will be used for Robotoff service to reach MongoDB and Redis hosted on ovh2 server.</p>
<p>We dont need a VM, a container is enough. I created CT 101 with the following parameters:</p>
<ul>
<li>1 CPU</li>
<li>512 MB of RAM (no swap)</li>
<li>8 GB of disk</li>
<li>network:<ul>
<li>ipv4: 10.3.0.101/8</li>
<li>no ipv6, as we will use internal ipv4</li>
<li>gateway: 10.0.0.45 (host)</li>
</ul>
</li>
<li>dns: I added <code>1.1.1.1</code> (cloudflare) as DNS</li>
</ul>
<h3 id="install-stunnel">Install stunnel<a class="headerlink" href="#install-stunnel" title="Permanent link">#</a></h3>
<p>The installation process follows <a href="https://openfoodfacts.github.io/openfoodfacts-infrastructure/reports/2024-01-04-setting-up-stunnel/">https://openfoodfacts.github.io/openfoodfacts-infrastructure/reports/2024-01-04-setting-up-stunnel/</a>.</p>
<ul>
<li>Install with <code>apt install stunnel4</code></li>
</ul>
<ul>
<li>
<p>Update <code>/etc/stunnel/off.conf</code> with the content in <code>openfoodfacts-infrastructure</code> repo, in <code>confs/moji-stunnel-client/stunnel/off.conf</code></p>
<ul>
<li>Override the systemd config of <code>stunnel@.service</code> with <code>systemctl edit stunnel@.service</code>:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">[</span>Service<span class="o">]</span>
<span class="c1"># we need to enable putting pit file in runtime directory, with right permissions</span>
<span class="c1"># while still starting as root (needed by stunnel)</span>
<span class="nv">Group</span><span class="o">=</span>stunnel4
<span class="nv">RuntimeDirectory</span><span class="o">=</span>stunnel-%i
<span class="nv">RuntimeDirectoryMode</span><span class="o">=</span><span class="m">0775</span>
</code></pre></div>
</li>
</ul>
<ul>
<li>Mask default stunnel4 config: <code>sudo systemctl mask stunnel4.service</code></li>
</ul>
<ul>
<li>start service: <code>systemctl start stunnel@off.service</code></li>
</ul>
<ul>
<li>enable service (to be launched as startup): <code>systemctl enable stunnel@off.service</code></li>
</ul>
<h2 id="stunnel-server-ct-configuration">stunnel-server CT configuration<a class="headerlink" href="#stunnel-server-ct-configuration" title="Permanent link">#</a></h2>
<h3 id="create-the-container_1">Create the container<a class="headerlink" href="#create-the-container_1" title="Permanent link">#</a></h3>
<p>This container will be used to allow external services to reach Robotoff API, through ipv6.</p>
<p>I created CT 102 with the following parameters:</p>
<ul>
<li>1 CPU</li>
<li>512 MB of RAM (no swap)</li>
<li>8 GB of disk</li>
<li>network:<ul>
<li>ipv4: 10.3.0.103/8, gateway: 10.0.0.45 (host)</li>
<li>ipv6: 2a06:c484:5::103/48, gateway: 2a06:c484:5::</li>
</ul>
</li>
</ul>
<h3 id="install-stunnel_1">Install stunnel<a class="headerlink" href="#install-stunnel_1" title="Permanent link">#</a></h3>
<p>Exactly the same procedure as for stunnel-client, but use <code>`confs/moji-stunnel-server/stunnel/off.conf</code> as configuration file.</p>
<h2 id="install-robotoff-services">Install Robotoff services<a class="headerlink" href="#install-robotoff-services" title="Permanent link">#</a></h2>
<ul>
<li>Clone robotoff repository in <code>robotoff-org</code></li>
<li>Install git LFS</li>
<li>Create external networks, create external volumes</li>
<li>Download ML models with <code>make dl-models</code></li>
<li>Configure .env file</li>
</ul>
<h2 id="ovh1-configuration">OVH1 configuration<a class="headerlink" href="#ovh1-configuration" title="Permanent link">#</a></h2>
<h3 id="added-ipv6-to-ovh1-proxy-ct-101">Added ipv6 to OVH1 Proxy CT (101)<a class="headerlink" href="#added-ipv6-to-ovh1-proxy-ct-101" title="Permanent link">#</a></h3>
<p>In proxmox network interface, I added an ipv6 to CT 101, so that the reverse proxy can reach <code>docker-prod-2</code> in ipv6:</p>
<ul>
<li>ipv6/CIDR: 2001:41d0:0203:948c::101/8 (fixed IP)</li>
<li>gateway: 2001:41d0:0203:94ff:00ff:00ff:00ff:00ff (as declared in OVH mecenat dashboard)</li>
</ul>
<h3 id="update-proxy-stunnel-configuration">Update proxy stunnel configuration<a class="headerlink" href="#update-proxy-stunnel-configuration" title="Permanent link">#</a></h3>
<p>We need to access InfluxDB from <code>docker-prod-2</code>, so we use the stunnel deployed in proxy (CT 101. We also need to configure OVH1 reverse proxy Robotoff API connection to stunnel.
We add the following configuration block to the stunnel configuration on CT 101 (reverse proxy):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># enabling connections to InfluxDB from outside</span>
<span class="o">[</span>InfluxDB<span class="o">]</span>
<span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>no
<span class="nv">accept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0.0.0:8087
<span class="nv">connect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>.1.0.201:8087
<span class="nv">ciphers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>PSK
<span class="c1"># this file and directory are private</span>
<span class="nv">PSKsecrets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/etc/stunnel/psk/influxdb-psk.txt

<span class="c1"># OVH1 reverse proxy is the only one that has IPv6, so we use this stunnel</span>
<span class="c1"># instead of the one of stunnel-client</span>
<span class="o">[</span>Robotoff<span class="o">]</span>
<span class="nv">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes
<span class="nv">accept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">127</span>.0.0.1:16000
<span class="c1"># Connect to stunnel-client of Moji server</span>
<span class="nv">connect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>2a06:c484:5::102:16000
<span class="nv">ciphers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>PSK
<span class="nv">PSKsecrets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/etc/stunnel/psk/robotoff-psk.txt
</code></pre></div>
<p>We enable the service with <code>systemctl enable stunnel@off.service</code> and restart it with <code>systemctl restart stunnel@off.service</code>.</p>
<h2 id="robotoff-migration">Robotoff migration<a class="headerlink" href="#robotoff-migration" title="Permanent link">#</a></h2>
<p>To migrate Robotoff to the new server, I did the following:</p>
<ul>
<li>Stop Robotoff services on OVH2</li>
<li>Migrate data from old server (OVH2) to new one (Moji): elasticsearch, redis, postgresql</li>
<li>Start services on Moji machine</li>
<li>Update the <code>proxy_pass</code> in nginx configuration (<code>robotoff.conf</code>) to point to the stunnel server (<code>127.0.0.1:16000</code>) running on CT 101</li>
</ul>
<p>The migration went smoothly, and Robotoff is now running on the new server.</p>
<h2 id="tasks-remaining">Tasks remaining<a class="headerlink" href="#tasks-remaining" title="Permanent link">#</a></h2>
<p>What remains to be done:</p>
<ul>
<li>configure GPU (GPU configuration documentation: <a href="https://pve.proxmox.com/wiki/NVIDIA_vGPU_on_Proxmox_VE">https://pve.proxmox.com/wiki/NVIDIA_vGPU_on_Proxmox_VE</a>). Indeed, we're not using the GPUs yet.</li>
<li>Configure backups (set-up sanoid)</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>