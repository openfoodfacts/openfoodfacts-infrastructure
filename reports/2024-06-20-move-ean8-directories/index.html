
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../2024-06-10-move-off-query-volume-to-nvme/">
      
      
        <link rel="next" href="../2024-08-03-ovh-reverse-proxy-ip-lost/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>Move EAN8 directories - Open Food Facts Infrastructure documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#move-ean8-directories" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Open Food Facts Infrastructure documentation" class="md-header__button md-logo" aria-label="Open Food Facts Infrastructure documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Open Food Facts Infrastructure documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Move EAN8 directories
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/openfoodfacts/openfoodfacts-infrastructure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Open Food Facts Infrastructure documentation" class="md-nav__button md-logo" aria-label="Open Food Facts Infrastructure documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Open Food Facts Infrastructure documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/openfoodfacts/openfoodfacts-infrastructure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open Food Facts Infrastructure
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cicd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Continous Integration and Continuous Delivery
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../discourse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Discourse
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../disks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disks
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker at Open Food Facts
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker_architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker_onboarding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Onboarding
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explain-server-config-in-git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation on server configuration with git
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../folksonomy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folksonomy API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../free-datacenter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Free Datacenter
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-add-disk-space-on-qemu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to add disk space on a Qemu VM
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-fail2ban-ban-bots/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use fail2ban to ban bots
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-fail2ban-debian-11%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to install fail2ban on debian 11+
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-have-server-config-in-git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to have server config in git
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-mitigate-crawlers-on-prod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to mitigate crawlers in case of too much traffic
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-to-resync-zfs-replication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to resync ZFS replication
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux-server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux server
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-off1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    off1 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-off2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    off2 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-off3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    off3 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-ovh1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ovh1 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-ovh2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ovh2 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../logs-ovh3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ovh3 server logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mail/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mail on Open Food Facts infrastructure
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../matomo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matomo
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../moji-datacenter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moji Datacenter
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mongodb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MongoDB
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../munin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Munin
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../nginx-reverse-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NGINX Reverse proxy
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Observability
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odoo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Odoo: our relationship management (connect.openfoodfacts.org)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openfoodfacts-query/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open Food Facts Query
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../postgres/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PostgreSQL
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../prod-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Production architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../producers_sftp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Producers SFTP
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../product-opener/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Product Opener
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../proxmox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proxmox
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rclone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rclone
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../redis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redis
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sanoid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sanoid
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../slackin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auto Slack invitation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stunnel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stunnel
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../zammad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zammad
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../zfs-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZFS overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_46" checked>
        
          
          <label class="md-nav__link" for="__nav_46" id="__nav_46_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reports
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_46_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_46">
            <span class="md-nav__icon md-icon"></span>
            Reports
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2021-02-22-matomo-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Matomo install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2021-10-03-network-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    [Postmortem] OpenFoodFacts.net down (#1)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2021-12-21-disk-extension/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disk extension for preprod and containers prod (ovh2)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2021-12-22-preprod-crash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprod crash 2021 12
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-02-18-ovh-reverse-proxy-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    [Postmortem] Reverse proxy down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-02-proxmox-mail-gateway-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install of proxmox gateway server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-02-remove-containers-ovh1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-02 Removing some containers on ovh1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-03-03-zammad-elasticsearch-not-running/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elasticsearch not running on Zammad
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-03-off2-PCI-NVMe-problems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-03 Problem with PCI supporting NVMe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-07-08-journey-to-deploy-off-search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying openfoodfacts-search to staging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-07-11-infra-workshop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure future - workshop on 11th July 2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-07-kibana-down-es-circuit-breaking-exception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kibana down because of Elasticsearch circuit_breaking_exception
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-08-17-openfoodfacts-net-unreachable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-08-17 openfoodfacts.net unreachable
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-09-23-odoo-setup-for-pro-platform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup of Odoo for pro platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2022-11-09-monitoring-move-to-own-vm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-11 moving monitoring to its own machine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-02-13-zammad-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-02-13 Zammad down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-02-16-off2-shutdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023 02 16 off2 shutdown
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-02-17-off2-upgrade/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-02-17 Off2 Upgrade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-02-24-zfs-introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023 02 24 zfs introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-03-14-off2-opff-reinstall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-03 OFF2 reinstall - opff migration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-04-27-moving-docker-stagging-to-ovh1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-04-27 moving docker staging to OVH1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-05-12-refresh-staging-clones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022-05-12 refresh staging clones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-05-19-overload-of-osm-machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-05-18 Mongodb down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-05-23-move-images-to-zfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-05-23 move Images to ZFS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-05-off2-110-unreachable/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-05-23 off2 - container 110 unreachable from 101
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-06-01-robotoff-backups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-06-01 Robotoff backups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-06-07-off2-opf-obf-reinstall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-06-07 OPF and OBF reinstall on off2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-06-08-stalled-zfs-sync-off-products/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2012-06-08 Stalled ZFS Sync for off products on ovh3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-06-30-sanoid-checks-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-06-30 Sanoid checks install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-07-16-ovh3-sdc-broken/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Post-mortem 2023-07-16 Disk sdc errors on OVH3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-07-26-off1-rpool-products-full/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-07-26 rpool/off/products dataset full on off1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-07-off-reinstall--prod-files-diff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023 07 off reinstall  prod files diff
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-07-off2-off-reinstall/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-06-07 OFF and OFF-pro reinstall on off2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-08-31-off2-products-snapshots-clean/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-08-31 OFF2 products snapshots clean
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-09-27-expired-ssl-certificate-for-images-on-off2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-09-27 / Expired SSL certificate for images.openfoodfacts.org on off2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-10-14-mongodb-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-10-14: mongodb-down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-11-28-google-drive-backup-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-11-28 setup a google drive backup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-11-28-ovh3-sdf-broken/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Post-mortem 2023-11-28 Disk sdf errors on OVH3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-12-08-off1-upgrade/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-12-08 off1 upgrade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2023-12-11-matomo-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-12-11 Matomo down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-02-monitoring-disk-space/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-01-02 monitoring disk space - filebeat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-03-mongodb-migration-off1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-01-03 MongoDB migration on off3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-04-setting-up-stunnel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024 01 04 setting up stunnel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-19-certbot-failure-off2-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-01-19 Certbot failure on off2 reverse proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-24-move-old-productopener-folders-to-backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-01-24 Move old Product Opener folders to backup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-01-matomo-perf-tunning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-01 Matomo performance tunning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-06-cleanup-products-snapshots/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-02-06 cleanup of products ssnapshots on off2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-08-prod-redis-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-02-08 Production Redis install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-13-chatwoot-translation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-02-13 Chatwoot translation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-13-matomo-fix-queue0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2014-02-13 Matomo fix Queue0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-20-exporter-on-mongodb-ct/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-02-20 Installing a prometheus exporter on mongodb container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-02-28-upgrade-redis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-02-28 Upgrade Redis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-03-17-ovh1-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-03-17 OVH1 Down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-03-restructure-backups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-03 Restructure backups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-03-separate-hdd-docker-vms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-03 separate HDD on docker VMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-04-03-moving-opf-obf-opff-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-03-04 Moving opf, obf and opff logs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-04-12-install-off-query-off1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-04 install off-query on off1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-04-18-matomo-multi-archival/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-04-18 Matomo multi archival
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-04-18-setup-dkim-google-workspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-04-18 Setup DKIM on Google Workspace
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-04-26-off2-obf-new-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023-06-07 New install of OBF on OFF2 with new generic code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-05-27-nginx-exporter-off2-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nginx exporter on off2 proxy and off
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-06-05-off1-reverse-proxy-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-06 OFF1 reverse proxy install + OFF images container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-06-10-move-off-query-volume-to-nvme/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Move off query volume to NVME
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Move EAN8 directories
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Move EAN8 directories
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#move-script-move_ean8_products_to_new_pathpl" class="md-nav__link">
    <span class="md-ellipsis">
      Move script move_ean8_products_to_new_path.pl
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#impacted-products" class="md-nav__link">
    <span class="md-ellipsis">
      Impacted products
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Impacted products">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#off" class="md-nav__link">
    <span class="md-ellipsis">
      OFF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opff" class="md-nav__link">
    <span class="md-ellipsis">
      OPFF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opf" class="md-nav__link">
    <span class="md-ellipsis">
      OPF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obf" class="md-nav__link">
    <span class="md-ellipsis">
      OBF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#moving-products" class="md-nav__link">
    <span class="md-ellipsis">
      Moving products
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Moving products">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-normalization" class="md-nav__link">
    <span class="md-ellipsis">
      Code normalization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#products-that-are-not-at-the-root-but-not-at-the-right-padded-path" class="md-nav__link">
    <span class="md-ellipsis">
      Products that are not at the root but not at the right padded path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#new-normalization" class="md-nav__link">
    <span class="md-ellipsis">
      New normalization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#products-with-changed-codes-update" class="md-nav__link">
    <span class="md-ellipsis">
      Products with changed codes update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    <span class="md-ellipsis">
      Test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-to-do-with-conflicting-products" class="md-nav__link">
    <span class="md-ellipsis">
      What to do with conflicting products?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What to do with conflicting products?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#products-that-already-exist-on-the-new-path-but-also-on-the-old-path" class="md-nav__link">
    <span class="md-ellipsis">
      Products that already exist on the new path, but also on the old path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-plan" class="md-nav__link">
    <span class="md-ellipsis">
      Migration plan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#move-obf-opf-opff-to-new-code-first" class="md-nav__link">
    <span class="md-ellipsis">
      Move OBF, OPF, OPFF to new code first
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risks-of-race-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Risks of race conditions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Risks of race conditions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#old-path-from-a-not-yet-migrated-flavor-moved-to-an-already-migrated-flavor" class="md-nav__link">
    <span class="md-ellipsis">
      Old path from a not yet migrated flavor moved to an already migrated flavor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#new-normalization-path-generation-code-live-but-products-not-yet-migrated" class="md-nav__link">
    <span class="md-ellipsis">
      New normalization / path generation code live, but products not yet migrated
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    <span class="md-ellipsis">
      Steps:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration" class="md-nav__link">
    <span class="md-ellipsis">
      Migration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opff_1" class="md-nav__link">
    <span class="md-ellipsis">
      OPFF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conflicts-on-opff" class="md-nav__link">
    <span class="md-ellipsis">
      Conflicts on OPFF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obf_1" class="md-nav__link">
    <span class="md-ellipsis">
      OBF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conflicts-on-obf" class="md-nav__link">
    <span class="md-ellipsis">
      Conflicts on OBF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-08-03-ovh-reverse-proxy-ip-lost/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-08-03 OVH Reverse proxy IP lost
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-08-07-wordpress-off-contents-fresh-install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-08-07-wordpress-off-contents-fresh-install
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-08-13-moji-server-installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moji server installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-08-22-postfix-exporter-on-pmg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-08-22 Adding postfix exporter to Proxmox Mail Gateway
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-09-04-move-off-query-to-moji/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-09-04 Move off query to moji
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-09-05-adding-ipv6-to-off2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-09-05 adding ipv6 to off2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-09-06-moji-post-installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Moji - Post-installation &amp; backup sync
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-09-06-test-folksonomy-openproductsfacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024-09-06 test folksonomy Open Products Facts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2024-09-24-kimsufi-stor-ks1-installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kimsufi STOR - ks1 installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#move-script-move_ean8_products_to_new_pathpl" class="md-nav__link">
    <span class="md-ellipsis">
      Move script move_ean8_products_to_new_path.pl
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#impacted-products" class="md-nav__link">
    <span class="md-ellipsis">
      Impacted products
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Impacted products">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#off" class="md-nav__link">
    <span class="md-ellipsis">
      OFF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opff" class="md-nav__link">
    <span class="md-ellipsis">
      OPFF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opf" class="md-nav__link">
    <span class="md-ellipsis">
      OPF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obf" class="md-nav__link">
    <span class="md-ellipsis">
      OBF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#moving-products" class="md-nav__link">
    <span class="md-ellipsis">
      Moving products
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Moving products">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#code-normalization" class="md-nav__link">
    <span class="md-ellipsis">
      Code normalization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#products-that-are-not-at-the-root-but-not-at-the-right-padded-path" class="md-nav__link">
    <span class="md-ellipsis">
      Products that are not at the root but not at the right padded path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#new-normalization" class="md-nav__link">
    <span class="md-ellipsis">
      New normalization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#products-with-changed-codes-update" class="md-nav__link">
    <span class="md-ellipsis">
      Products with changed codes update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test" class="md-nav__link">
    <span class="md-ellipsis">
      Test
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-to-do-with-conflicting-products" class="md-nav__link">
    <span class="md-ellipsis">
      What to do with conflicting products?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="What to do with conflicting products?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#products-that-already-exist-on-the-new-path-but-also-on-the-old-path" class="md-nav__link">
    <span class="md-ellipsis">
      Products that already exist on the new path, but also on the old path
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-plan" class="md-nav__link">
    <span class="md-ellipsis">
      Migration plan
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration plan">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#move-obf-opf-opff-to-new-code-first" class="md-nav__link">
    <span class="md-ellipsis">
      Move OBF, OPF, OPFF to new code first
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#risks-of-race-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Risks of race conditions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Risks of race conditions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#old-path-from-a-not-yet-migrated-flavor-moved-to-an-already-migrated-flavor" class="md-nav__link">
    <span class="md-ellipsis">
      Old path from a not yet migrated flavor moved to an already migrated flavor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#new-normalization-path-generation-code-live-but-products-not-yet-migrated" class="md-nav__link">
    <span class="md-ellipsis">
      New normalization / path generation code live, but products not yet migrated
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    <span class="md-ellipsis">
      Steps:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration" class="md-nav__link">
    <span class="md-ellipsis">
      Migration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opff_1" class="md-nav__link">
    <span class="md-ellipsis">
      OPFF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conflicts-on-opff" class="md-nav__link">
    <span class="md-ellipsis">
      Conflicts on OPFF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obf_1" class="md-nav__link">
    <span class="md-ellipsis">
      OBF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conflicts-on-obf" class="md-nav__link">
    <span class="md-ellipsis">
      Conflicts on OBF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="move-ean8-directories">Move EAN8 directories<a class="headerlink" href="#move-ean8-directories" title="Permanent link">#</a></h1>
<p>See https://github.com/openfoodfacts/openfoodfacts-server/issues/3818</p>
<h2 id="move-script-move_ean8_products_to_new_pathpl">Move script move_ean8_products_to_new_path.pl<a class="headerlink" href="#move-script-move_ean8_products_to_new_pathpl" title="Permanent link">#</a></h2>
<p>The script goes through product directories that are at the root of the products directory,
and move product directories to a structured path.</p>
<p>e.g. 99723824 to 000/009/972/3824</p>
<p>The script is made to work on both the new codebase (running on OFF) and the old code base (running on OPF, OBF, OPFF).</p>
<p>At first, the script does not do the move, but checks how many products would be impacted:</p>
<h2 id="impacted-products">Impacted products<a class="headerlink" href="#impacted-products" title="Permanent link">#</a></h2>
<h3 id="off">OFF<a class="headerlink" href="#off" title="Permanent link">#</a></h3>
<p>254867 products at the root - 0 products not empty or deleted
invalid code: 2
moved: 248924
not moved: 5942
same path: 0
changed code: 65599</p>
<h3 id="opff">OPFF<a class="headerlink" href="#opff" title="Permanent link">#</a></h3>
<p>1054 products at the root - 0 products not empty or deleted
invalid code: 1
moved: 1054
not moved: 0
same path: 0
changed code: 397</p>
<h3 id="opf">OPF<a class="headerlink" href="#opf" title="Permanent link">#</a></h3>
<p>1480 products at the root - 0 products not empty or deleted
invalid code: 1
moved: 1480
not moved: 0
same path: 0
changed code: 417</p>
<h3 id="obf">OBF<a class="headerlink" href="#obf" title="Permanent link">#</a></h3>
<p>3983 products at the root - 0 products not empty or deleted
invalid code: 1
moved: 3969
not moved: 14
same path: 0
changed code: 1487</p>
<h2 id="moving-products">Moving products<a class="headerlink" href="#moving-products" title="Permanent link">#</a></h2>
<p>We need to move products on OFF, OBF, OPF and OPFF roughly at the same time, in order to avoid issues if products are moved from one flavor to another that uses a different barcode to path mapping.</p>
<h3 id="code-normalization">Code normalization<a class="headerlink" href="#code-normalization" title="Permanent link">#</a></h3>
<p>As short barcodes are padded with 0s, we need to make sure that we normalize unpadded barcodes and padded barcodes to the same barcode. As EAN8 are primarily referred to with 8 digit barcodes, we have decided before to normalize to 8 digits.</p>
<p>Normalization with current code on OFF + OBF / OPF / OPFF:</p>
<ul>
<li>UPC12 (only the ones that are valid EANs) / EAN13 / 0 + EAN13 : normalized to 13 digits</li>
<li>EAN8 : normalized to 8 digits</li>
</ul>
<p>In practice we have some products currently stored with EAN8s padded with 0s with paths like 000/006/911/0146
Those are currently not reachable (read or write), and are likely to contain outdated data.</p>
<h3 id="products-that-are-not-at-the-root-but-not-at-the-right-padded-path">Products that are not at the root but not at the right padded path<a class="headerlink" href="#products-that-are-not-at-the-root-but-not-at-the-right-padded-path" title="Permanent link">#</a></h3>
<p>There are some products with 4, 5, 6, 7, (not 8), 9, 10, 11 digits:
https://world.openfoodfacts.org/product/00000111222/pollo-fino-scharf
That are stored in paths like:
000/001/112/22/</p>
<p>We should pad the paths to 13 digits:
000/000/011/1222/</p>
<p>Those products need to be moved as well, otherwise they won't be reachable.</p>
<h3 id="new-normalization">New normalization<a class="headerlink" href="#new-normalization" title="Permanent link">#</a></h3>
<p>In order to not have different products with codes that differ only by leading 0s,
I'm changing the normalization so that:</p>
<p>Leading 0s are removed for codes with more than 13 digits.
Leading 0s are added so that we have 13 digits.
Except when leading 0s can be removed in order to have only 8 digits.</p>
<h3 id="products-with-changed-codes-update">Products with changed codes update<a class="headerlink" href="#products-with-changed-codes-update" title="Permanent link">#</a></h3>
<p>Need to:</p>
<ul>
<li>remove old code from MongoDB</li>
<li>notify REDIS of removal of old code</li>
<li>update new code in .sto file (in a new revision, for better traceability, and possible rollback)</li>
<li>update mongodb</li>
</ul>
<h3 id="test">Test<a class="headerlink" href="#test" title="Permanent link">#</a></h3>
<p>Tested locally in dev environment with 10k products.</p>
<h2 id="what-to-do-with-conflicting-products">What to do with conflicting products?<a class="headerlink" href="#what-to-do-with-conflicting-products" title="Permanent link">#</a></h2>
<h3 id="products-that-already-exist-on-the-new-path-but-also-on-the-old-path">Products that already exist on the new path, but also on the old path<a class="headerlink" href="#products-that-already-exist-on-the-new-path-but-also-on-the-old-path" title="Permanent link">#</a></h3>
<p>This is possible when products were also created with extra leading 0s (e.g. if a scanner or a producer added 0s).</p>
<p>DECISION: assume the old path is more likely to contain better data. Move the new path to a backup folder, and the old path to the new path.</p>
<p>On OFF we have 5942 products with conflicts (that exist in multiple paths).</p>
<h2 id="migration-plan">Migration plan<a class="headerlink" href="#migration-plan" title="Permanent link">#</a></h2>
<h3 id="move-obf-opf-opff-to-new-code-first">Move OBF, OPF, OPFF to new code first<a class="headerlink" href="#move-obf-opf-opff-to-new-code-first" title="Permanent link">#</a></h3>
<p>Otherwise we would need to make similar changes to the normalization on the old code.</p>
<h3 id="risks-of-race-conditions">Risks of race conditions<a class="headerlink" href="#risks-of-race-conditions" title="Permanent link">#</a></h3>
<h4 id="old-path-from-a-not-yet-migrated-flavor-moved-to-an-already-migrated-flavor">Old path from a not yet migrated flavor moved to an already migrated flavor<a class="headerlink" href="#old-path-from-a-not-yet-migrated-flavor-moved-to-an-already-migrated-flavor" title="Permanent link">#</a></h4>
<p>If OBF / OPF / OPFF / OFF is updated while another flavor is not, and we move an old path to a flavor that has already been updated:</p>
<ul>
<li>If the product does not exist on the target flavor, it gets an old path. We could run again the migration scripts on all flavors one more time, once all flavors have been updated once.</li>
<li>If the product exists on the target flavor, we will miss it.</li>
</ul>
<p>If we do the moves of all flavors on the same day, the risk is rather small.</p>
<p>One way to avoid it could be to disable moving products while we migrate. But it's more steps for a rather small benefit.</p>
<p>DECISIONS:</p>
<ul>
<li>Migrate OFF first, as most products get moved from OFF to other flavors. Then move other flavors.</li>
<li>Ask moderators not to move products during the migration.</li>
</ul>
<h4 id="new-normalization-path-generation-code-live-but-products-not-yet-migrated">New normalization / path generation code live, but products not yet migrated<a class="headerlink" href="#new-normalization-path-generation-code-live-but-products-not-yet-migrated" title="Permanent link">#</a></h4>
<p>When we update one flavor, the new normalization and path generation code will be live, but the products will take time to migrate. In the mean time, those products will appear to be non-existing if someone tries to access their product page (or call the API).</p>
<p>One option could be to stop the service while we run the migration script (but it might take hours, especially on OFF where we need to move 250k products.</p>
<p>Or we could change the code to make it work with both old paths and new paths.</p>
<p>DECISION: change the Product Opener code (split_code function) so that if the old normalized path exist (which means the product has not been migrated), we use it.</p>
<h3 id="steps">Steps:<a class="headerlink" href="#steps" title="Permanent link">#</a></h3>
<ol>
<li>Move OBF, OPF, OPFF to new code (before the PR https://github.com/openfoodfacts/openfoodfacts-server/pull/10472 is merged)</li>
<li>Migrate OFF
- Ask moderators not to move products
- Deploy https://github.com/openfoodfacts/openfoodfacts-server/pull/10472 on OFF
- Stop and start Apache, so that Product Opener can read and write products on both the old path (if it exists) and the new path
- Run the migration script to migrate products from the old paths to the new paths</li>
<li>Migrate OBF, OPF, OPFF</li>
<li>Create a PR to remove the code that checks if the old path exists.</li>
</ol>
<h2 id="migration">Migration<a class="headerlink" href="#migration" title="Permanent link">#</a></h2>
<p>Started migration on 2024/10/02.</p>
<p>Changed initial plan to start with OPFF first, in order to uncover issues in a less used environment (much fewer products and updates)</p>
<h3 id="opff_1">OPFF<a class="headerlink" href="#opff_1" title="Permanent link">#</a></h3>
<p>Dry run in OPFF:</p>
<p>Fixed some permissions in /mnt/opff (some directories like "logs" were owned by root, changed to off:off)</p>
<p>1099 products at the root
invalid code: 1 -&gt; "invalid"
moved: 1098
not moved: 0
same path: 0
changed code: 417</p>
<p>Fixed: Issue with products that are deleted, they should not be added back to mongodb.</p>
<p>There's an issue with products have a changed code (not only a changed path) with leading 0s: they can't be retrieved until they are moved. Fixing by removing leading 0s in old_split_code(). This partially work: if a product code already has some leading 0s but not the right number, the new code won't find the product until it has migrated. It could be fixed, but probably not worth the complexity.</p>
<p>Also disabling the redirect from old code to new code in order not to have redirect loops.
TODO: will need to reenable the redirect once the migration is complete.</p>
<p>There are some products with 1 or 2 digits. Those are most likely bogus. We will remove those products instead of padding them with zeroes. The corresponding files are moved to products/invalid-barcodes</p>
<h3 id="conflicts-on-opff">Conflicts on OPFF<a class="headerlink" href="#conflicts-on-opff" title="Permanent link">#</a></h3>
<p>new path exists, not moving 527/427/749/0 to 000/527/427/7490
new path exists, not moving 649/922/801/7 to 000/649/922/8017</p>
<h3 id="obf_1">OBF<a class="headerlink" href="#obf_1" title="Permanent link">#</a></h3>
<p>4226 products at the root or not split into a 4 component path
57 products paths containing other products
invalid code: 0
moved: 4210
not moved: 16
same path: 0
changed code: 1663</p>
<h3 id="conflicts-on-obf">Conflicts on OBF<a class="headerlink" href="#conflicts-on-obf" title="Permanent link">#</a></h3>
<p>22 products to update
new path exists, not moving 000/000/000/00 to 000/000/000/0000
new path exists, not moving 0006 to 000/000/000/0006
new path exists, not moving 00432 to 000/000/000/0432
new path exists, not moving 06147198 to 000/000/614/7198
new path exists, not moving 101/810/403/13 to 001/018/104/0313
new path exists, not moving 1048 to 000/000/000/1048
new path exists, not moving 1211 to 000/000/000/1211
new path exists, not moving 123/456/789/05 to 001/234/567/8905
new path exists, not moving 1262 to 000/000/000/1262
new path exists, not moving 187/879/433/59 to 001/878/794/3359
new path exists, not moving 191/001/943/04 to 001/910/019/4304
new path exists, not moving 207/142/228/57 to 002/071/422/2857
new path exists, not moving 227/969/161/12 to 002/279/691/6112
new path exists, not moving 263/950/011/63 to 002/639/500/1163
new path exists, not moving 30106659 to 000/003/010/6659
new path exists, not moving 370/012/430/6 to 000/370/012/4306
new path exists, not moving 565/940/046/72 to 005/659/400/4672
new path exists, not moving 62263436 to 000/006/226/3436
new path exists, not moving 705/010/171/04 to 007/050/101/7104
new path exists, not moving 705/010/270/04 to 007/050/102/7004
new path exists, not moving 705/010/609/57 to 007/050/106/0957
new path exists, not moving 794/000/134/39 to 007/940/001/3439</p>
<p>Note: now moving conflicts to products/conflicting-codes/</p>
<h1 id="opf_1">OPF<a class="headerlink" href="#opf_1" title="Permanent link">#</a></h1>
<p>11 products paths containing other products
invalid code: 0
moved: 1542
not moved: 0
same path: 0
changed code: 443</p>
<h1 id="off_1">OFF<a class="headerlink" href="#off_1" title="Permanent link">#</a></h1>
<p>271562 products at the root or not split into a 4 component path
621 products paths containing other products
invalid code: 0
moved: 262432
not moved: 9130
same path: 0
changed code: 68061</p>
<h2 id="serving-images-with-old-image-paths">Serving images with old image paths<a class="headerlink" href="#serving-images-with-old-image-paths" title="Permanent link">#</a></h2>
<p>Robotoff and some 3rd party apps compute themselves the paths of the images.
This means that they will use the old paths, unless they are updated.</p>
<p>To avoid serving 404s, we add rules in the nginx proxy of the product opener containers to be able to serve images with the old paths:</p>
<div class="highlight"><pre><span></span><code>location ~ ^/images/products/ {
        # 2024/10/03 - temporary redirects as we changed the path of images
        # for barcodes that are 8 digits or less
        rewrite ^/images/products/(....)/([^/]*)$ /images/products/000/000/000/$1/$2 break;
        rewrite ^/images/products/(.)(....)/([^/]*)$ /images/products/000/000/00$1/$2/$3 break;
        rewrite ^/images/products/(..)(....)/([^/]*)$ /images/products/000/000/0$1/$2/$3 break;
        rewrite ^/images/products/(...)(....)/([^/]*)$ /images/products/000/000/$1/$2/$3 break;
        rewrite ^/images/products/(.)(...)(....)/([^/]*)$ /images/products/000/00$1/$2/$3/$4 break;
        rewrite ^/images/products/(..)(...)(....)/([^/]*)$ /images/products/000/0$1/$2/$3/$4 break;
</code></pre></div>
<p>A better solution could be to return 302 redirects.</p>
<p>One issue during the migration is that we cannot have the rules active until all products are migrated.
One way to avoid that could have been to use try_file instead of redirects... </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>